{% extends 'bootstrap/base.html' %}


{% block scripts %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='bower_components/jqwidgets/jqwidgets/styles/jqx.base.css') }}">

<script src="{{ url_for('static', filename='bower_components/jquery/dist/jquery.js') }}"></script>
<script src="{{ url_for('static', filename='bower_components/socket.io-client/dist/socket.io.js') }}"></script>
<script src="{{ url_for('static', filename='bower_components/plotlyjs/plotly.js') }}"></script>

<script src="{{ url_for('static', filename='bower_components/jqwidgets/jqwidgets/jqxcore.js') }}"></script>
<script src="{{ url_for('static', filename='bower_components/jqwidgets/jqwidgets/jqxchart.js') }}"></script>
<script src="{{ url_for('static', filename='bower_components/jqwidgets/jqwidgets/jqxgauge.js') }}"></script>

<script>
  // Establish socketio connection
  var socket;

  $(document).ready(function() {
    socket = io.connect('http://' + document.domain + ':' + location.port);

    // Update current process data
    socket.on('update', function(data) {
      // Set current timestamp
      $('#timestamp').text(data['t']);

      // Enable/Disable Heater and Mixer
      if (data['ht_en']) {
        $('#enableHeater').addClass('btn-primary');
      }
      else {
        $('#enableHeater').removeClass('btn-primary');
      };

      if (data['mx_en']) {
        $('#enableMixer').addClass('btn-primary');
      }
      else {
        $('#enableMixer').removeClass('btn-primary');
      }
    });

    // Enable / Disable Heater state
    $('#enableHeater').click(function() {
      if ($(this).hasClass('btn-primary')) {
        socket.emit('disable heater');
      }
      else {
        socket.emit('enable heater');
      }
    });

    socket.on('heater enabled', function() {
      $('#enableHeater').addClass('btn-primary');
    });

    socket.on('heater disabled', function() {
      $('#enableHeater').removeClass('btn-primary');
    })

    // Enable / Disabe mixer state
    $('#enableMixer').click(function() {
      if ($(this).hasClass('btn-primary')) {
        socket.emit('disable mixer');
      }
      else {
        socket.emit('enable mixer');
      }
    })

    socket.on('mixer enabled', function() {
      $('#enableMixer').addClass('btn-primary')
    });

    socket.on('mixer disabled', function() {
      $('#enableMixer').removeClass('btn-primary');
    });
  });
</script>
{% endblock %}


{% block navbar %}
<div class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbarCollapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="{{ url_for('main.index') }}"><img src="{{ url_for('static', filename='logo.png') }}"></a>
    </div>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <button id="enableHeater" class="btn btn-default navbar-btn{% if heater_enabled %} btn-primary{% endif %}">Heizung</button>
      <button id="enableMixer" class="btn btn-default navbar-btn{% if mixer_enabled %} btn-primary{% endif %}">RÃ¼hrwerk</button>
      <ul class="nav navbar-nav">
        <li><a href="{{ url_for('main.settings') }}">Einstellungen</a>
      </ul>
      <p class="navbar-text pull-right" id="timestamp" style="display: inline;"></p>
    </div>
  </div>
</div>
{% endblock %}